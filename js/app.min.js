var userObj;blogin();var firebaseConfig={apiKey:"AIzaSyBvDwnFtfHuNYb3PMQNfLEh6-WKf4PFqkY",authDomain:"mental-arithmatic.firebaseapp.com",databaseURL:"https://mental-arithmatic.firebaseio.com",projectId:"mental-arithmatic",storageBucket:"mental-arithmatic.appspot.com",messagingSenderId:"1058394091077",appId:"1:1058394091077:web:590b3a9841776c761f3d2c"};function login(){$("#loginButton").html('<div class="spinner-border spinner-border-sm" role="status"><span class="sr-only"></span></div> Processing');var email=$("#sign-in-email").val(),password=$("#sign-in-pass").val();firebase.auth().signInWithEmailAndPassword(email,password).then(user=>{userObj=user}).catch(error=>{"auth/user-not-found"==error.code?$("#signupModal").modal("show"):"auth/wrong-password"==error.code&&alert("Wrong Password. Please Check your Password again."),$("#loginButton").html("Log In")})}function alogin(){$(".blogin").fadeOut(500),$(".alogin").fadeIn(500),setpar(),retrieveData()}function blogin(){$(".blogin").fadeIn(500),$(".alogin").fadeOut(500)}function signOut(){firebase.auth().signOut().then((function(){})).catch((function(error){alert(error.message)}))}function setpar(){$(".email").html(userObj.email)}function retrieveData(){firebase.database().ref("valid_accounts").on("value",(function(snapshot){var a=snapshot.val();dataObj=a;var b=["<tr><th>ID</th><th>Paid Month</th><th>Remove</th></tr>"];for(i in a)b.push(`<tr><td>${i}</td><td>${a[i].paidFor}</td><td><a href="#" class="btn btn-danger" onclick="revoke('${i}')">Revoke</a></td></tr>`);$("#dataTable").html(b.join(""))})),firebase.database().ref("smat").on("value",(function(snapshot){var a=snapshot.val();dataObj=a;var b=["<tr><th>ID</th><th></th><th>Name</th><th>E-Mail</th><th>Attempts</th><th>Last CPS</th><th></th></tr>"];for(i in a){var dis;try{lastCPS=a[i].Attempts[a[i].Attempts.length-1].cps,dis=""}catch{lastCPS="Never Started",dis="disabled"}b.push(`<tr><td>${i}</td><td><button onclick="monitor('${i}')" class="btn btn-primary" ${dis}>View</button></td><td>${a[i].name}</td><td>${a[i].email}</td><td>${a[i].currentAttempt||"Never Started"}</td><td>${lastCPS}</td><td><button onclick="massMonitor('${i}')" class="btn btn-primary" ${dis}>Add To Mass Monitor</button></td></tr>`)}$("#monitorTable").html(b.join(""))}))}function revoke(dir){confirm(`Are you sure you want to Revoke ${dir}?`)?firebase.database().ref(`valid_accounts/${dir}/`).remove():alert(`Revoke for ${dir} Cancelled`)}function bulkRevoke(){if(confirm(`Are you sure you want to Revoke ${$("#SMonth").val()} Month?`))for(i in dataObj)dataObj[i].paidFor==$("#SMonth").val()&&firebase.database().ref(`valid_accounts/${i}/`).remove();else alert("Bulk Revoke Cancelled")}function submitPayment(){firebase.database().ref(`valid_accounts/${$("#ID").val()}/`).update({paidFor:$("#Month").val()}),$("#payment")[0].reset()}function monitor(ID){firebase.database().ref(`smat/${ID}/name/`).once("value",(function(snap){$(".statName").html(snap.val())})),firebase.database().ref(`smat/${ID}/Attempts/`).limitToLast(100).once("value",(function(snapshot){var lab=[],avg=[],lar=[],dar=[],cnt=0;snapshot.forEach((function(childSnapshot){var childKey=childSnapshot.key,childData=childSnapshot.val();lab.push(childKey),avg.push(parseFloat(childData.cps))})),$(".avg").text(math.mean(avg).toFixed(3));for(var i=avg.length-1;i>=0&&20!=cnt;i--)lar.push(lab[i]),dar.push(avg[i]),cnt+=1;lar.reverse(),dar.reverse();var data={labels:lar,series:[{data:dar}]},options={axisX:{labelInterpolationFnc:function(value){return"A"+value}}},responsiveOptions=[["screen and (min-width: 641px) and (max-width: 1024px)",{showPoint:!1,axisX:{labelInterpolationFnc:function(value){return"A"+value}}}],["screen and (max-width: 640px)",{showPoint:!1,axisX:{labelInterpolationFnc:function(value){return"A"+value}}}]];new Chartist.Line("#progressionChart",data,options,responsiveOptions)}))}function massMonitor(ID){$(`#A${ID}main`).length?alert("Already Added"):($("#massMonitoringSection").append(`<div style="margin:10px; margin-left:0px;" class="card conDiv" id="A${ID}main"><h3>Statics Of <span class="A${ID}statName">The User</span><a style="color:red;float:right;" onclick="$('#A${ID}main').remove()"> X</a></h3><em>Average <span class="A${ID}avg">0</span></em><div id="A${ID}progressionChart" style="width: 100%;"></div></div>`),firebase.database().ref(`smat/${ID}/name/`).once("value",(function(snap){$(`.A${ID}statName`).html(snap.val())})),firebase.database().ref(`smat/${ID}/Attempts/`).limitToLast(100).on("value",(function(snapshot){var lab=[],avg=[],lar=[],dar=[],cnt=0;snapshot.forEach((function(childSnapshot){var childKey=childSnapshot.key,childData=childSnapshot.val();lab.push(childKey),avg.push(parseFloat(childData.cps))})),$(`.A${ID}avg`).text(math.mean(avg).toFixed(3));for(var i=avg.length-1;i>=0&&20!=cnt;i--)lar.push(lab[i]),dar.push(avg[i]),cnt+=1;lar.reverse(),dar.reverse();var data={labels:lar,series:[{data:dar}]},options={axisX:{labelInterpolationFnc:function(value){return"A"+value}}},responsiveOptions=[["screen and (min-width: 641px) and (max-width: 1024px)",{showPoint:!1,axisX:{labelInterpolationFnc:function(value){return"A"+value}}}],["screen and (max-width: 640px)",{showPoint:!1,axisX:{labelInterpolationFnc:function(value){return"A"+value}}}]];new Chartist.Line(`#A${ID}progressionChart`,data,options,responsiveOptions)})))}firebase.initializeApp(firebaseConfig),firebase.auth().onAuthStateChanged((function(user){user?(userObj=user,alogin()):blogin()})),$(document).ready((function(){$("#searchbox").on("keyup",(function(){var value=$(this).val().toLowerCase();$("#dataTable tr").filter((function(){$(this).toggle($(this).text().toLowerCase().indexOf(value)>-1)}))}))})),$(document).ready((function(){$("#monitorSearch").on("keyup",(function(){var value=$(this).val().toLowerCase();$("#monitorTable tr").filter((function(){$(this).toggle($(this).text().toLowerCase().indexOf(value)>-1)}))}))}));